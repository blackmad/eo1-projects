images = ["images/IMG_0001.JPG","images/IMG_0002.JPG","images/IMG_0003.JPG","images/IMG_0004.JPG","images/IMG_0005.JPG","images/IMG_0006.JPG","images/IMG_0007.JPG","images/IMG_0008.JPG","images/IMG_0009.JPG","images/IMG_0010.JPG","images/IMG_0011.JPG","images/IMG_0012.JPG","images/IMG_0013.JPG","images/IMG_0014.JPG","images/IMG_0015.JPG","images/IMG_0016.JPG","images/IMG_0017.JPG","images/IMG_0018.JPG","images/IMG_0019.JPG","images/IMG_0020.JPG","images/IMG_0021.JPG","images/IMG_0022.JPG","images/IMG_0029.JPG","images/IMG_0030.JPG","images/IMG_0032.JPG","images/IMG_0036.JPG","images/IMG_0037.JPG","images/IMG_0038.JPG","images/IMG_0039.JPG","images/IMG_0040.JPG","images/IMG_0042.JPG","images/IMG_0043.JPG","images/IMG_0044.JPG","images/IMG_0045.JPG","images/IMG_0046.JPG","images/IMG_0047.JPG","images/IMG_0048.JPG","images/IMG_0049.JPG","images/IMG_0050.JPG","images/IMG_0052.JPG","images/IMG_0053.JPG","images/IMG_0054.JPG","images/IMG_0055.JPG","images/IMG_0056.JPG","images/IMG_0057.JPG","images/IMG_0058.JPG","images/IMG_0059.JPG","images/IMG_0060.JPG","images/IMG_0062.JPG","images/IMG_0063.JPG","images/IMG_0064.JPG","images/IMG_0065.JPG","images/IMG_0066.JPG","images/IMG_0067.JPG","images/IMG_0068.JPG","images/IMG_0069.JPG","images/IMG_0070.JPG","images/IMG_0071.JPG","images/IMG_0072.JPG","images/IMG_0073.JPG","images/IMG_0074.JPG","images/IMG_0075.JPG","images/IMG_0076.JPG","images/IMG_0077.JPG","images/IMG_0078.JPG","images/IMG_0079.JPG","images/IMG_0080.JPG","images/IMG_0081.JPG","images/IMG_0082.JPG","images/IMG_0083.JPG","images/IMG_0084.JPG","images/IMG_0085.JPG","images/IMG_0086.JPG","images/IMG_0087.JPG","images/IMG_0088.JPG","images/IMG_0089.JPG","images/IMG_0090.JPG","images/IMG_0091.JPG","images/IMG_0092.JPG","images/IMG_0093.JPG","images/IMG_0094.JPG","images/IMG_0095.JPG","images/IMG_0096.JPG","images/IMG_0097.JPG","images/IMG_0098.JPG","images/IMG_0099.JPG","images/IMG_0100.JPG","images/IMG_0101.JPG","images/IMG_0102.JPG","images/IMG_0103.JPG","images/IMG_0104.JPG","images/IMG_0105.JPG","images/IMG_0107.JPG","images/IMG_0108.JPG","images/IMG_0109.JPG","images/IMG_0110.JPG","images/IMG_0111.JPG","images/IMG_0117.JPG","images/IMG_0118.JPG","images/IMG_0119.JPG","images/IMG_0120.JPG","images/IMG_0121.JPG","images/IMG_0122.JPG","images/IMG_0123.JPG","images/IMG_0124.JPG","images/IMG_0125.JPG","images/IMG_0126.JPG","images/IMG_0127.JPG","images/IMG_0128.JPG","images/IMG_0129.JPG","images/IMG_0130.JPG","images/IMG_0131.JPG","images/IMG_0132.JPG","images/IMG_0133.JPG","images/IMG_0134.JPG","images/IMG_0135.JPG","images/IMG_0136.JPG","images/IMG_0137.JPG","images/IMG_0138.JPG","images/IMG_0139.JPG","images/IMG_0140.JPG","images/IMG_0141.JPG","images/IMG_0142.JPG","images/IMG_0143.JPG","images/IMG_0144.JPG","images/IMG_0145.JPG","images/IMG_0146.JPG","images/IMG_0147.JPG","images/IMG_0148.JPG","images/IMG_0149.JPG","images/IMG_0150.JPG","images/IMG_0151.JPG","images/IMG_0152.JPG","images/IMG_0153.JPG","images/IMG_0154.JPG","images/IMG_0155.JPG","images/IMG_0156.JPG","images/IMG_0157.JPG","images/IMG_0158.JPG","images/IMG_0159.JPG","images/IMG_0160.JPG","images/IMG_0161.JPG","images/IMG_0162.JPG","images/IMG_0163.JPG","images/IMG_0164.JPG","images/IMG_0165.JPG","images/IMG_0166.JPG","images/IMG_0167.JPG","images/IMG_0168.JPG","images/IMG_0169.JPG","images/IMG_0170.JPG","images/IMG_0171.JPG","images/IMG_0172.JPG","images/IMG_0173.JPG","images/IMG_0174.JPG","images/IMG_0175.JPG","images/IMG_0176.JPG","images/IMG_0177.JPG","images/IMG_0178.JPG","images/IMG_0179.JPG","images/IMG_0180.JPG","images/IMG_0181.JPG","images/IMG_0182.JPG","images/IMG_0183.JPG","images/IMG_0184.JPG","images/IMG_0185.JPG","images/IMG_0186.JPG","images/IMG_0187.JPG","images/IMG_0188.JPG","images/IMG_0189.JPG","images/IMG_0190.JPG","images/IMG_0191.JPG","images/IMG_0192.JPG","images/IMG_0193.JPG","images/IMG_0194.JPG","images/IMG_0195.JPG","images/IMG_0196.JPG","images/IMG_0197.JPG","images/IMG_0198.JPG","images/IMG_0199.JPG","images/IMG_0200.JPG","images/IMG_0201.JPG","images/IMG_0202.JPG","images/IMG_0203.JPG","images/IMG_0204.JPG","images/IMG_0205.JPG","images/IMG_0206.JPG","images/IMG_0207.JPG","images/IMG_0208.JPG","images/IMG_0209.JPG","images/IMG_0210.JPG","images/IMG_0211.JPG","images/IMG_0212.JPG","images/IMG_0213.JPG","images/IMG_0214.JPG","images/IMG_0215.JPG","images/IMG_0216.JPG","images/IMG_0219.JPG","images/IMG_0220.JPG","images/IMG_0222.JPG","images/IMG_0223.JPG","images/IMG_0224.JPG","images/IMG_0225.JPG","images/IMG_0226.JPG","images/IMG_0227.JPG","images/IMG_0231.JPG","images/IMG_0232.JPG","images/IMG_0233.JPG","images/IMG_0234.JPG","images/IMG_0235.JPG","images/IMG_0236.JPG","images/IMG_0237.JPG","images/IMG_0238.JPG","images/IMG_0239.JPG","images/IMG_0240.JPG","images/IMG_0241.JPG","images/IMG_0242.JPG","images/IMG_0243.JPG","images/IMG_0244.JPG","images/IMG_0245.JPG","images/IMG_0246.JPG","images/IMG_0247.JPG","images/IMG_0249.JPG","images/IMG_0250.JPG","images/IMG_0251.JPG","images/IMG_0252.JPG","images/IMG_0253.JPG","images/IMG_0255.JPG","images/IMG_0256.JPG","images/IMG_0258.JPG","images/IMG_0260.JPG","images/IMG_0261.JPG","images/IMG_0262.JPG","images/IMG_0263.JPG","images/IMG_0264.JPG","images/IMG_0266.JPG","images/IMG_0267.JPG","images/IMG_0268.JPG","images/IMG_0269.JPG","images/IMG_0270.JPG","images/IMG_0271.JPG","images/IMG_0272.JPG","images/IMG_0273.JPG","images/IMG_0274.JPG","images/IMG_0275.JPG","images/IMG_0276.JPG","images/IMG_0277.JPG","images/IMG_0278.JPG","images/IMG_0279.JPG","images/IMG_0280.JPG","images/IMG_0281.JPG","images/IMG_0282.JPG","images/IMG_0283.JPG","images/IMG_0284.JPG","images/IMG_0285.JPG","images/IMG_0286.JPG","images/IMG_0287.JPG","images/IMG_0288.JPG","images/IMG_0289.JPG","images/IMG_0290.JPG","images/IMG_0291.JPG","images/IMG_0293.JPG","images/IMG_0294.JPG","images/IMG_0295.JPG","images/IMG_0296.JPG","images/IMG_0297.JPG","images/IMG_0298.JPG","images/IMG_0300.JPG","images/IMG_0301.JPG","images/IMG_0302.JPG","images/IMG_0303.JPG","images/IMG_0304.JPG","images/IMG_0305.JPG","images/IMG_0306.JPG","images/IMG_0308.JPG","images/IMG_0309.JPG","images/IMG_0310.JPG","images/IMG_0311.JPG","images/IMG_0312.JPG","images/IMG_0313.JPG","images/IMG_0314.JPG","images/IMG_0315.JPG","images/IMG_0316.JPG","images/IMG_0317.JPG","images/IMG_0321.JPG","images/IMG_0322.JPG","images/IMG_0323.JPG","images/IMG_0324.JPG","images/IMG_0325.JPG","images/IMG_0326.JPG","images/IMG_0327.JPG","images/IMG_0328.JPG","images/IMG_0329.JPG","images/IMG_0330.JPG","images/IMG_0331.JPG","images/IMG_0332.JPG","images/IMG_0333.JPG","images/IMG_0334.JPG","images/IMG_0335.JPG","images/IMG_0336.JPG","images/IMG_0338.JPG","images/IMG_0339.JPG","images/IMG_0340.JPG","images/IMG_0341.JPG","images/IMG_0342.JPG","images/IMG_0343.JPG","images/IMG_0344.JPG","images/IMG_0345.JPG","images/IMG_0346.JPG","images/IMG_0347.JPG","images/IMG_0348.JPG","images/IMG_0349.JPG","images/IMG_0352.JPG","images/IMG_0353.JPG","images/IMG_0354.JPG","images/IMG_0355.JPG","images/IMG_0356.JPG","images/IMG_0357.JPG","images/IMG_0358.JPG","images/IMG_0359.JPG","images/IMG_0360.JPG","images/IMG_0361.JPG","images/IMG_0362.JPG","images/IMG_0363.JPG","images/IMG_0364.JPG","images/IMG_0365.JPG","images/IMG_0366.JPG","images/IMG_0367.JPG","images/IMG_0368.JPG","images/IMG_0369.JPG","images/IMG_0370.JPG","images/IMG_0371.JPG","images/IMG_0372.JPG","images/IMG_0373.JPG","images/IMG_0374.JPG","images/IMG_0375.JPG","images/IMG_0376.JPG","images/IMG_0377.JPG","images/IMG_0378.JPG","images/IMG_0379.JPG","images/IMG_0380.JPG","images/IMG_0381.JPG","images/IMG_0382.JPG","images/IMG_0383.JPG","images/IMG_0384.JPG","images/IMG_0385.JPG","images/IMG_0386.JPG","images/IMG_0387.JPG","images/IMG_0388.JPG","images/IMG_0389.JPG","images/IMG_0390.JPG","images/IMG_0391.JPG","images/IMG_0392.JPG","images/IMG_0393.JPG","images/IMG_0394.JPG","images/IMG_0395.JPG","images/IMG_0396.JPG","images/IMG_0397.JPG","images/IMG_0398.JPG","images/IMG_0399.JPG","images/IMG_0400.JPG","images/IMG_0401.JPG","images/IMG_0402.JPG","images/IMG_0403.JPG","images/IMG_0404.JPG","images/IMG_0405.JPG","images/IMG_0406.JPG","images/IMG_0407.JPG","images/IMG_0408.JPG","images/IMG_0411.JPG","images/IMG_0412.JPG","images/IMG_0413.JPG","images/IMG_0414.JPG","images/IMG_0415.JPG","images/IMG_0416.JPG","images/IMG_0417.JPG"]

/* TODO:
- have this talk to an image API
- write said API
- randomly swap out image chunks
- periodically start over
- do the right thing if you're starting with a wide image
*/

$(document).ready(function() {
  var rows = 6;
  var cols = 5;

  var window_width = window.innerWidth;
  var window_height = window.innerHeight;

  var stage = new Konva.Stage({
      container: 'container',
      width: window_width,
      height: window_height
  });

  var first_image_width = null;
  var first_image_height = null;
  var cell_width = null;
  var cell_height = null;

  function drawImage(index, imageObj) {
    var row = Math.floor(index / cols)
    var col = index % cols

    var img_width = imageObj.width;
    var img_height = imageObj.height;

    if (!first_image_width) {
      if (img_width > img_height) {
        console.log('wide image w > h:  ' + img_width + ' > ' + img_height)
        first_image_width = window_width;
        first_image_height = img_height * (window_width / img_width)
      } else {
        first_image_height = window_height;
        first_image_width = img_width * (window_height / img_height)
      }
      cell_height = first_image_height / rows;
      cell_width = first_image_width / cols;
    }

    console.log('this is image is size h:' + img_height + ' w: ' + img_width)
    console.log('first image is size h:' + first_image_height + ' w: ' + first_image_width)
    console.log('window size is h: ' + window_height + ' w: ' + window_width)
    console.log('natural: h: ' + imageObj.naturalHeight + ', w: ' + imageObj.naturalWidth)

    var layer = new Konva.Layer();
    
    var konvaImg = new Konva.Image({
        image: imageObj,
        x: cell_width * col,
        y: cell_height * row,
        width: cell_width,
        height: cell_height,
        draggable: false,
        blurRadius: 20,
        crop: {
          // width: cell_width * 10,
          // height: cell_height * 10

          // // this is taking the proportional chunk of the original image
          // // and displaying it scaled
          // x: img_width * (col / cols),
          // y: img_height * (row / rows),
          // width: img_width / cols,
          // height: img_height / rows

          // this is trying to take half of the proportionl chunk of the image
          // so that it gets nicely blown up 2x
          x: (img_width * (col / cols)) + (img_width / (cols*2)),
          y: (img_height * (row / rows)) + (img_width / (cols*2)),
          width: img_width / (cols*2),
          height: img_height / (rows*2)
          
          // this is very beautiful and also wrong
          // x: img_width * (col/cols),
          // y: img_height * (row/rows),
          // width: cell_width * (first_image_width / img_width),
          // height: cell_height * (first_image_height / img_height)
        }
    });

    konvaImg.cache();
    konvaImg.filters([Konva.Filters.Blur]);

    layer.add(konvaImg);
    stage.add(layer);
  }

  function draw0(img) { console.log('draw0'); drawImage(0, img); }

  _.times(rows*cols, function(index) {
    console.log(images[0])
    var image = images[index]
    var img = new Image();  
    img.onload = function(imageObj) {
       EXIF.getData(img, function(data) {
        console.log(data)
        var orientation = EXIF.getTag(this, "Orientation");
        console.log(orientation);
        img.src = orient(img, orientation);
        img.onload = function(none) {
          drawImage(index, img)
        }
      });
    }
    img.src = image;
  })
})